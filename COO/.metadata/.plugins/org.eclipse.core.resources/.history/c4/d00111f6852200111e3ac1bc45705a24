package extensions;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.File;
import java.io.FilenameFilter;
import java.util.ArrayList;
import java.util.List;

import javax.swing.Timer;



public class PluginChecker 
{
	protected File directory;
	protected List<PluginListener> pluginListeners;
	protected int delay;
	protected PluginEvent pluginEvent;
	protected Timer scheduler;
	
	public PluginChecker(int delay, String dir)
	{
		this.directory = new File(dir);
		this.delay = delay;
		this.pluginListeners = new ArrayList<PluginListener>();
	}
	
	public void addPlugin(String extName)
	{
		// a voir ...
		this.pluginEvent = new PluginEvent(this, extName);
		this.firePluginAdded();
	}
	
	protected void firePluginAdded()
	{
		for (PluginListener pl : this.pluginListeners)
		{
			pl.pluginAdded(pluginEvent);
		}
	}
	
	public void removePlugin(String extName)
	{
		this.pluginEvent = new PluginEvent(this, extName);
		this.firePluginRemoved();
	}
	
	public void firePluginRemoved()
	{
		for (PluginListener pl : this.pluginListeners)
		{
			pl.pluginRemoved(pluginEvent);
		}	
	}
	
	public void addPluginListener(PluginListener listener)
	{
		if (pluginListeners.contains(listener))
			return;
		
		this.pluginListeners.add(listener);
	}
	
	public void removePluginListener(PluginListener listener)
	{
		this.pluginListeners.remove(listener);
	}
	
	public void createTimer()
	{
		this.scheduler = new Timer(this.delay,new ActionListener()
						{
							protected String[] newFileName;
							protected String[] fileName;
							protected int length = 0;
							protected int newLength;
							protected FilenameFilter onlyClassFile = new OnlyClassFile();
							
							@Override
							public void actionPerformed(ActionEvent arg0) 
							{
								this.newFileName = PluginChecker.this.directory.list(this.onlyClassFile);
								this.newLength = this.fileName.length;
								
								if (this.newLength > length)
								{
									for (int i = 0; i< this.newLength; i++)
									{
										if (this.fileName[i].contentEquals(newFileName[i]))
									}
								} 
								else
								{
									
								}
								this.length = this.newLength;
							}
						});
	}
}
