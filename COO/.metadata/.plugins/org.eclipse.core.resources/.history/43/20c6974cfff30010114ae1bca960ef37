package oie;

import java.util.*;

/**
 * 
 * @author franziz
 * the game that contains the players and the field
 */
public class Game 
{
	protected List<Player> thePlayers;
	protected Board board;
	
	public Game(Board board)
	{
		this.thePlayers = new ArrayList<Player>();
		this.board = board;
	}
	
	public void addPlayer(Player p)
	{
		thePlayers.add(p);
	}
	
	public void play()
	{
		int diceResult = 0;
		int  consequence = 0;
		int currentInd  =0;
		Player swapPlay;
		
		while (noPlayerWon())
		{
			System.out.println(board.toString());
			for (int i=0; i<thePlayers.size();i++)
			{
				currentInd = thePlayers.get(i).getCell().getIndex(); 					// index of the current player

				if (board.getCell(currentInd).canBeLeft())
				{
					diceResult = thePlayers.get(i).twoDicesThrow();						// result of the twoDicesThrow
					consequence = thePlayers.get(i).getCell().consequence(diceResult);	// the index of the new cell
					
					if (board.getCell(consequence).isBusy())							// case of swap players
					{
						swapPlay = board.getCell(consequence).getPlayer();
						thePlayers.get(i).setCell(board.getCell(consequence));
						swapPlay.setCell(board.getCell(currentInd));
						System.out.println("_ is on cell " + currentInd + " and go to : " +consequence);
						System.out.println(swapPlay.toString() + " go to :" + swapPlay.getCell().getIndex());
					}
					else 
					{
						thePlayers.get(i).setCell(board.getCell(consequence));
						board.getCell(currentInd).setPlayer(null);
						System.out.println("_ is on cell " + currentInd + " and go to : " +consequence);
					}
				}
			}
		}
		System.out.println("end");
	}
	
	public boolean noPlayerWon()
	{
		for (int i=0; i<thePlayers.size();i++)
		{
			if (thePlayers.get(i).getCell().getIndex() == this.board.getNbOfCells() - 1)
				return false;
		}
		
		return true;
	}
	
	public static void main (String []args)
	{
		Board board = new Board(64);
		Game game = new Game(board);
		
		game.addPlayer(new Player("B",board.getCell(0)));
		game.addPlayer(new Player("T",board.getCell(0)));
		
		game.play();
	}
}
