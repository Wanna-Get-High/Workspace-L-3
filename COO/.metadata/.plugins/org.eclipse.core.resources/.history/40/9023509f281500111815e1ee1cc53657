package questionnairesUI;


import java.awt.GridLayout;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.io.*;
import java.lang.reflect.InvocationTargetException;
import java.util.*;
import javax.swing.*;

import questionnaires.Question;
import questionnaires.Questionnaire;


public class QuestionnaireUI 
{
	int points;
	JButton submit;
	JFrame frame;
	JOptionPane option;
	List <AnswerUI<?>> answers;
	
	public QuestionnaireUI(Questionnaire q)
	{
		this.answers = new ArrayList<AnswerUI<?>>();
		this.frame = new JFrame("Questionnaire");
		this.frame.setLayout(new GridLayout(q.getNumberOfQuestions()+1,2));
		
		// add all the Answers to a List
		for (Question quest : q.getQuestions())
		{
			this.answers.add(quest.getAnswer().getUI(quest));
		}
		
		//use that List to create the frame
		for (AnswerUI<?> ans : this.answers)
		{
			this.frame.add(new JLabel(ans.getQuestion().getQuestion()));
			this.frame.add(ans.getPanel());
		}
		
		this.submit = new JButton("submit");
		this.submit.addActionListener(new SubmitAnswers());
		this.option = new JOptionPane("Result");
		
		this.frame.add(this.submit);
		
		this.frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		this.frame.pack();
		this.frame.setVisible(true);
	}
	
	 public static void main(String[] args)
	    {
	    	Questionnaire quiz = new Questionnaire();
	    	try {
				quiz.initQuestionnaire("question_tolkien.txt");
			} catch (FileNotFoundException e) {
				e.printStackTrace();
			} catch (IllegalArgumentException e) {
				e.printStackTrace();
			} catch (IOException e) {
				e.printStackTrace();
			} catch (NoSuchMethodException e) {
				e.printStackTrace();
			} catch (IllegalAccessException e) {
				e.printStackTrace();
			} catch (InvocationTargetException e) {
				e.printStackTrace();
			} catch (ClassNotFoundException e) {
				e.printStackTrace();
			}
			
			new QuestionnaireUI(quiz);
	    }
	 
	 class SubmitAnswers implements ActionListener 
	 {
		 
		@Override
		public void actionPerformed(ActionEvent arg)
		{
			String mes="";
			int it=1;

			for (AnswerUI<?> ans : QuestionnaireUI.this.answers)
			{
				if (ans.getAnswer().checkAnswer(ans.getValue()))
					QuestionnaireUI.this.points += ans.getQuestion().getPoints();
				
				else
					mes += "Q"+it+" : Wrong the correct answer was : " +ans.getAnswer().toString()+"\n";
				
				it++;
			}
			
			mes +="\nYou have won "+QuestionnaireUI.this.points+" points";
			
			JOptionPane.showMessageDialog(frame, mes);
		}
	 }
}


